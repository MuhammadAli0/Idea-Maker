<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Home</title>
    <script src="/web/js/jquery.min.js"></script>
    <script>

        loadPage();
        function getCookie(cname) {
            var name = cname + "=";
            var decodedCookie = decodeURIComponent(document.cookie);
            var ca = decodedCookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }

                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        // function to make form values to json format
        $.fn.serializeObject = function () {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };

        function loadPage() {
            // validate jwt to verify access
            var jwt = getCookie('jwt');
            var data = JSON.stringify({
                "status": 200,
                "jwt": jwt
            });
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;
            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    try {
                        result = $.parseJSON(this.responseText)
                        if (result) {

                            $('#test').html(this.responseText);
                            console.log(result);


                            // ShowAccountUpdateForm();
                        } else {
                            // on error/fail, tell the user he needs to login to show the account page
                            $('#response').html("<div class='alert alert-danger'>Please login to access the account page.</div>");
                            // window.location.href = "https://" + window.location.hostname + "?login";

                        }
                    }
                    catch (err) {
                        // on error/fail, tell the user he needs to login to show the account page
                        $('#response').html("<div class='alert alert-danger'>Please login to access the account page.</div>");
                        // window.location.href = "https://" + window.location.hostname + "?login";
                    }
                }
            });
            xhr.open("POST", "https://" + window.location.hostname + "/api/index.php/home/");
            xhr.setRequestHeader("content-type", "application/json");
            xhr.setRequestHeader("cache-control", "no-cache");
            xhr.send(data);


        }


    </script>
</head>

<body>
    <div id="response">
        <h1> Welcome To Home Page </h1>
        <h2> <a href="EditProfile.html"> Edit Profile </a> </h2>
        <p id="test"> </p>
    <script>

    </script>
</body>

</html>